ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 1.
Hexadecimal [16-Bits]



                              1 ;;;;;;;;;;;;;;;;;;;;;;;
                              2 ;; Physics System
                              3 ;;   Definition to entities physics
                              4 ;;
                              5 .module Physics_System
                              6 
                     0050     7 screen_width  = 80
                     00C8     8 screen_height = 200
                              9 
                             10 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                             11 ;; Code
                             12 ;;
                             13 .area _DATA
                             14 .area _CODE
                             15 
   0000                      16 physics_sys_init::
   0000 C9            [10]   17     ret
                             18 
                             19 ;; Input
                             20 ;;   IX: Pointer to first entity to render
                             21 ;;    A: Number of entities to render
   0001                      22 physics_sys_update::
   0001 47            [ 4]   23     ld  b, a
                             24 
   0002                      25 _update_loop:
                             26     ;; Update X
   0002 3E 51         [ 7]   27     ld    a, #screen_width + 1
   0004 DD 96 00      [19]   28     sub   e_w(ix)
   0007 4F            [ 4]   29     ld    c, a
                             30 
   0008 DD 7E 00      [19]   31     ld    a, e_x(ix)
   000B DD 86 00      [19]   32     add   e_vx(ix)
   000E B9            [ 4]   33     cp    c             ;; Comprueba con la primera posicion invalida
   000F 30 05         [12]   34     jr   nc, invalid_x
   0011                      35 valid_x:
   0011 DD 77 00      [19]   36     ld   e_x(ix), a
   0014 18 00         [12]   37     jr   endif_x
   0016                      38 invalid_x:
                             39     
   0016                      40 endif_x:
                             41 
                             42     ;; Update Y
   0016 3E C9         [ 7]   43     ld    a, #screen_height + 1
   0018 DD 96 00      [19]   44     sub   e_h(ix)
   001B 4F            [ 4]   45     ld    c, a
                             46 
   001C DD 7E 00      [19]   47     ld    a, e_y(ix)
   001F DD 86 00      [19]   48     add   e_vy(ix)
   0022 B9            [ 4]   49     cp    c             ;; Comprueba con la primera posicion invalida
   0023 30 05         [12]   50     jr   nc, invalid_y
   0025                      51 valid_y:
   0025 DD 77 00      [19]   52     ld   e_y(ix), a
   0028 18 07         [12]   53     jr   endif_y
   002A                      54 invalid_y:
                             55     ;; IX
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 2.
Hexadecimal [16-Bits]



   002A C5            [11]   56     push bc
   002B D5            [11]   57     push de
   002C CD 00 00      [17]   58     call entity_man_destroy  ;; Modify HL, DE, BC
   002F D1            [10]   59     pop de
   0030 C1            [10]   60     pop bc
   0031                      61 endif_y:
                             62 
   0031 05            [ 4]   63     dec  b
   0032 C8            [11]   64     ret  z
                             65 
   0033 11 00 00      [10]   66     ld  de, #entity_size
   0036 DD 19         [15]   67     add ix, de
   0038 18 C8         [12]   68     jr _update_loop
                             69 
   003A C9            [10]   70     ret
